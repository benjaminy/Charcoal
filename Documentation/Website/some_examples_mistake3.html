<html>
<head>
<title>Some Examples</title>
<style media="screen" type="text/css">
pre { display:inline }
.highlight {
  background-color:white;
  padding:0.3em;
  margin:0.3em;
}
</style>
</head>
<body style="background-color:darkgray">

<div style="background-color:seashell;width:35em;margin-left:auto;margin-right:auto;padding:2em">

<p>What if we add something
like <span style="font-family:monospace">done</span> to the by-value
variables list?</p>

<div class="highlight" style="font-family:monospace">
<table><tbody><tr>
<td align="right" valign="top">
1:<br/>2:<br/>3:<br/>4:<br/>5:<br/>6:<br/>7:<br/>8:<br/>9:<br/>10:<br/>
11:<br/>12:<br/>13:<br/>14:<br/>15:<br/>16:<br/>17:<br/>18:</td>
<td>&nbsp;</td>
<td valign="top">
<i>void</i> <b>multi_dns_conc</b>(<br/>
<pre>    </pre><i>size_t</i> <b>N</b>, <i>char</i> **<b>names</b>, <b><u>struct</u></b> <i>addrinfo</i> **<b>infos</b> )<br/>
{<br/>
<pre>    </pre><i>size_t</i> <b>i</b>, <b>done</b> = 0;<br/>
<pre>    </pre><i>semaphore_t</i> <b>done_sem</b>;<br/>
<pre>    </pre>sem_init( &amp;done_sem, 0 );<br/>
<pre>    </pre><b><u>for</u></b>( i = 0; i &lt; N; ++i )<br/>
<pre>    </pre>{<br/>
<pre>        </pre><b><u>activate</u></b> ( i, <span style="background-color:yellow">done</span> ) <br/>
<pre>        </pre>{<br/>
<pre>            </pre>assert( 0 == getaddrinfo(<br/>
<pre>                </pre>names[i], NULL, NULL, &amp;infos[i] ) );<br/>
<pre>            </pre><b><u>if</u></b>( ( ++done ) == N )<br/>
<pre>                </pre>sem_inc( &amp;done_sem );<br/>
<pre>        </pre>}<br/>
<pre>    </pre>}<br/>
<pre>    </pre>sem_dec( &amp;done_sem );<br/>
}
</td>
</tr></tbody></table>
</div>

<p>This should be a relatively easy bug to find and fix.  All of the
lookup activities will get their own copy
of <span style="font-family:monospace">done</span> (each of which will
be initialized to 0).  None of the activities will perform the semaphore
increment on line 14, so the main activity will be stuck forever.</p>

</div>
</body>
</html>
